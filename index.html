<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maze Maker</title>
    <script src="js/pixi.min.js"></script>
    <script>
        let app, player;
        let keys = {};
        let keysDiv;
        let walls = [];

        // constants for player movement
        const W = "87";
        const A = "65";
        const S = "83";
        const D = "68";
        const LEFT = "37";
        const UP = "38";
        const RIGHT = "39";
        const DOWN = "40";

        const SPEED = 5;

        window.onload = function() {
            app = new PIXI.Application(
                {
                    width: 800,
                    height: 600,
                    backgroundColor: 0xAAAAAA
                }
            );
            document.body.appendChild(app.view);

            // create the player object
            player = new PIXI.Sprite.from("images/player.png");
            // where transformations are relative to
            player.anchor.set(0.5); // set to center
            // set player position
            player.x = app.view.width / 2;
            player.y = app.view.height / 2;
            app.stage.addChild(player);

            //create a wall object
            wall = new PIXI.Sprite.from("images/brick.jpg");
            wall.x = 100;
            wall.y = 100;

            wall.width = 32;
            wall.height = 32;

            app.stage.addChild(wall);
            walls.push(wall);

            // keyboard event listeners
            window.addEventListener("keydown", keysDown);
            window.addEventListener("keyup", keysUp);

            // ticker to call gameLoop function during Pixi eventhandler
            app.ticker.add(gameLoop);
            // to display key info in the body
            keysDiv = document.querySelector("#keys");

            function keysDown (e) {
                console.log(e.keyCode);
                keys[e.keyCode] = true;
            }

            function keysUp (e) {
                console.log(e.keyCode);
                keys[e.keyCode] = false;
            }

            function gameLoop() {
                keysDiv.innerHTML = JSON.stringify(keys);
                
                // player movement
                if (keys[W] || keys[UP] && player.y > 0) { player.y -= collisionUp(walls)} 
                if (keys[A] || keys[LEFT] && player.x > 0) { player.x -= collisionLeft(walls) }
                if (keys[S] || keys[DOWN] && player.y < 600) { player.y += collisionDown(walls) }
                if (keys[D] || keys[RIGHT] && player.x < 800) { player.x += collisionRight(walls) }
            }

            function collisionDown(walls) {
                for(i=0; i<walls.length; i++) {
                    pBox = player.getBounds();
                    wBox = walls[i].getBounds();
                    if (pBox.y + pBox.height == wBox.y && pBox.x > wBox.x - wBox.width && pBox.x < wBox.x + wBox.width) {
                        return 0;
                    }
                }
                return SPEED;
            } 

            function collisionUp(walls) {
                for(i=0; i<walls.length; i++) {
                    pBox = player.getBounds();
                    wBox = walls[i].getBounds();
                    if (pBox.y - pBox.height == wBox.y && pBox.x > wBox.x - wBox.width && pBox.x < wBox.x + wBox.width) {
                        return 0;
                    }
                }
                return SPEED;
            }

            function collisionLeft(walls) {
                for(i=0; i<walls.length; i++) {
                    pBox = player.getBounds();
                    wBox = walls[i].getBounds();
                    if (pBox.x - pBox.width < wBox.x && pBox.x > wBox.x && pBox.y > wBox.y - wBox.height && pBox.y < wBox.y + wBox.height) {
                        return 0;
                    }
                }
                return SPEED;
            }

            function collisionRight(walls) {
                for(i=0; i<walls.length; i++) {
                    pBox = player.getBounds();
                    wBox = walls[i].getBounds();
                    if (pBox.x + pBox.width > wBox.x && pBox.y > wBox.y - wBox.height && pBox.y < wBox.y + wBox.height) {
                        return 0;
                    }
                }
                return SPEED;
            }
        }
    </script>
</head>
<body>
    <div id="keys"></div>
</body>
</html>